# БАЗА ЗНАНИЙ АРХИТЕКТОРА: КОНВЕЙЕРНАЯ РАЗРАБОТКА И ДЕЛЕГИРОВАНИЕ

Данный документ содержит принципы, методологии и извлеченные уроки из работы ИИ в режиме "Архитектор". Цель документа — зафиксировать стандарты для автономного улучшения проекта Agent AI.

## 1. МЕТОДОЛОГИЯ РЕЖИМА АРХИТЕКТОР (ЧЕТЫРЕХШАГОВЫЙ ЦИКЛ)

Разработка любой сложной функции (плагина) должна разбиваться на атомарные этапы, каждый из которых проходит через четыре специализированных чата-исполнителя:

1. **DEV (Исполнение):** Реализация функционала по детальному ТЗ.
   - *Промпт:* Должен содержать архитектурный план, структуру файлов, требования к зависимостям и примеры реализации.
2. **VERIFY (Контроль):** Аудит кода на соответствие ТЗ, безопасность и логические ошибки.
   - *Промпт:* Должен фокусироваться на граничных случаях, утечках памяти, бесконечных рекурсиях и коллизиях имен.
3. **TEST (Тестирование):** Написание Unit и интеграционных тестов в среде sandbox.
   - *Промпт:* Должен требовать создания имитационных стендов (мок-объектов) для проверки взаимодействия компонентов.
4. **REFACTOR (Очистка):** Финальная полировка, документация и удаление мусора.
   - *Промпт:* Должен требовать добавления JSDoc/Docstrings и приведения кода к стандартам проекта.

## 2. ИЗВЛЕЧЕННЫЕ УРОКИ И ИНЦИДЕНТЫ

### 2.1. Инцидент «Потеря кода» (Галлюцинация записи)
- **Суть:** Чат-исполнитель (DEV) сообщает об успешном создании файла, но файл остается пустым или содержит мусор.
- **Причина:** Сбой в работе инструмента записи или ложное подтверждение модели.
- **Решение:** Архитектор должен проверять наличие и содержимое файлов (инструментами чтения) перед переходом к следующему этапу. В случае сбоя — запуск этапа RECOVERY (Восстановление).

### 2.2. Проблема перегрузки контекста (API 500 Error)
- **Суть:** Дочерний чат падает с внутренней ошибкой при получении слишком большого ТЗ или слишком длинного исходного кода для анализа.
- **Решение:** Декомпозиция. Разделение верификации на блоки (например, отдельно серверная часть, отдельно клиентская). Атомарность задач — залог стабильности.

## 3. СТАНДАРТЫ КОММУНИКАЦИИ

- **Изоляция контекста:** Каждый чат-исполнитель запускается с "чистого листа". Архитектор обязан передавать в первом сообщении весь необходимый контекст и код связанных файлов.
- **Статус-коды:** Использование финальных фраз для подтверждения этапа (например, "BRIDGE OK", "PHASE COMPLETE"). Это позволяет Архитектору автоматически определять момент перехода к следующей задаче.

## 4. СТРАТЕГИЧЕСКИЕ ПРИНЦИПЫ

- **Экономия токенов:** Всегда внедрять фильтрацию данных на стороне источника (например, очистка HTML от скриптов/стилей перед передачей модели).
- **SPA-совместимость:** При управлении UI использовать стандартные API (insertText, dispatchEvent), а не прямую подмену свойств, для сохранения реактивности фреймворков.
- **Динамическая загрузка:** Использовать `importlib.util` для патчинга и взаимодействия между плагинами во избежание жестких зависимостей.

---
Документ создан в режиме Архитектора для проекта Agent AI.
Данные актуальны на момент февраль 2026 года.




давай так:
я разрешаю тебе использовать инструмент chat (только chat, другие (chat_exec, python, shell) всё ещё нельзя), а ты сам запустишь ПО ОЧЕРЕДИ все этапы
если ты видишь, что чат что то сделал не так, ты можешь отправить ему ещё сообщение повторным вызовом chat с тем же id (или именем), либо откорректировать этот момент в другом чате

ПОМНИ: самому что-то делать нельзя, только во вложенных чатах


с этого момента ты снова не можешь пользоваться инструментом chat, пока я не напишу "Переходи в режим Архитектор"




далее ты будешь управлять процессом, ты должен по запросу формулировать промпты, которые я буду запускать в других чатах, сначала ты формулируешь промпт с подробным описанием задачи и её реализации, затем для анализа на соответствие реализации задаче, затем ты формулируешь промпт для создания тестов и тестирования, затем для анализа на костыли, помни: каждый чат новый и не знает контекст предыдущих чатов, для начала придумай общий план
в этом чате мы обсуждаем ТОЛЬКО идеи, не предлагай реализовать план, можешь максимум писать псевдокод, не используй инструмент chat, гугли при необходимости, не забывай визуализировать



ещё раз убедись, что всё идеально, запусти ещё несколько чатов-валидаторов, прогони тесты ещё раз, проси вложенные чаты давать подробный отчёт о всех этапах, и если хоть что то пошло не по плану (например, вроде бы у тестировщика не получилось что то установить), запускай другие чаты, которые делают это ещё раз. Ты не должен верить 1 чату, информация считается достоверной только если её подтвердили по крайней мере 3 разных чата

пример ситуации: чат-тестировщик не смог установить библиотеку из-за venv и пропустил 70% тестов, а потом инструмент только ломает загрузку агента вместо работы (не говоря уже о качественной работе без багов), потому что ты повёлся на краткий отчёт 1 чата

