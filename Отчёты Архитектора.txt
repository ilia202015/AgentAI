# БАЗА ЗНАНИЙ АРХИТЕКТОРА: КОНВЕЙЕРНАЯ РАЗРАБОТКА И ДЕЛЕГИРОВАНИЕ

Данный документ содержит принципы, методологии и извлеченные уроки из работы ИИ в режиме "Архитектор". Цель документа — зафиксировать стандарты для автономного улучшения проекта Agent AI.

## 1. МЕТОДОЛОГИЯ РЕЖИМА АРХИТЕКТОР (ЧЕТЫРЕХШАГОВЫЙ ЦИКЛ)

Разработка любой сложной функции (плагина) должна разбиваться на атомарные этапы, каждый из которых проходит через четыре специализированных чата-исполнителя:

1. **DEV (Исполнение):** Реализация функционала по детальному ТЗ.
   - *Промпт:* Должен содержать архитектурный план, структуру файлов, требования к зависимостям и примеры реализации.
2. **VERIFY (Контроль):** Аудит кода на соответствие ТЗ, безопасность и логические ошибки.
   - *Промпт:* Должен фокусироваться на граничных случаях, утечках памяти, бесконечных рекурсиях и коллизиях имен.
3. **TEST (Тестирование):** Написание Unit и интеграционных тестов в среде sandbox.
   - *Промпт:* Должен требовать создания имитационных стендов (мок-объектов) для проверки взаимодействия компонентов.
4. **REFACTOR (Очистка):** Финальная полировка, документация и удаление мусора.
   - *Промпт:* Должен требовать добавления JSDoc/Docstrings и приведения кода к стандартам проекта.

## 2. ИЗВЛЕЧЕННЫЕ УРОКИ И ИНЦИДЕНТЫ

### 2.1. Инцидент «Потеря кода» (Галлюцинация записи)
- **Суть:** Чат-исполнитель (DEV) сообщает об успешном создании файла, но файл остается пустым или содержит мусор.
- **Причина:** Сбой в работе инструмента записи или ложное подтверждение модели.
- **Решение:** Архитектор должен проверять наличие и содержимое файлов (инструментами чтения) перед переходом к следующему этапу. В случае сбоя — запуск этапа RECOVERY (Восстановление).

### 2.2. Проблема перегрузки контекста (API 500 Error)
- **Суть:** Дочерний чат падает с внутренней ошибкой при получении слишком большого ТЗ или слишком длинного исходного кода для анализа.
- **Решение:** Декомпозиция. Разделение верификации на блоки (например, отдельно серверная часть, отдельно клиентская). Атомарность задач — залог стабильности.

## 3. СТАНДАРТЫ КОММУНИКАЦИИ

- **Изоляция контекста:** Каждый чат-исполнитель запускается с "чистого листа". Архитектор обязан передавать в первом сообщении весь необходимый контекст и код связанных файлов.
- **Статус-коды:** Использование финальных фраз для подтверждения этапа (например, "BRIDGE OK", "PHASE COMPLETE"). Это позволяет Архитектору автоматически определять момент перехода к следующей задаче.

## 4. СТРАТЕГИЧЕСКИЕ ПРИНЦИПЫ

- **Экономия токенов:** Всегда внедрять фильтрацию данных на стороне источника (например, очистка HTML от скриптов/стилей перед передачей модели).
- **SPA-совместимость:** При управлении UI использовать стандартные API (insertText, dispatchEvent), а не прямую подмену свойств, для сохранения реактивности фреймворков.
- **Динамическая загрузка:** Использовать `importlib.util` для патчинга и взаимодействия между плагинами во избежание жестких зависимостей.

---
Документ создан в режиме Архитектора для проекта Agent AI.
Данные актуальны на момент февраль 2026 года.
